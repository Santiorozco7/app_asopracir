<div class="container" *ngIf="modalVisible">
  <div class="header">
    <a href="javascript:void(0);" class="link left" [ngClass]="{ disabled: (firstQualityWeights.length != 0 || secondQualityWeights.length != 0) && encargado != '' }" (click)="cerrar()" *ngIf="!mostrarTodos">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
        <path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
      </svg>
      <span>Atrás</span>
    </a>
    <a href="javascript:void(0);" class="link left" (click)="toggleVerTodos()" *ngIf="mostrarTodos">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
        <path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
      </svg>
      <span>Atrás</span>
    </a>
    <h2 class="subtitle">recolección</h2>
    <a href="javascript:void(0);" class="link right" (click)="toggleVerTodos()" *ngIf="!mostrarTodos">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
        <path d="M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z" />
      </svg>
    </a>
    <a href="javascript:void(0);" class="link right" (click)="filter()" *ngIf="mostrarTodos">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
        <path d="M0 224c0 17.7 14.3 32 32 32s32-14.3 32-32c0-53 43-96 96-96H320v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9S320 19.1 320 32V64H160C71.6 64 0 135.6 0 224zm512 64c0-17.7-14.3-32-32-32s-32 14.3-32 32c0 53-43 96-96 96H192V352c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V448H352c88.4 0 160-71.6 160-160z" />
      </svg>
    </a>
  </div>
  <div class="main__content" *ngIf="!mostrarTodos">
    <div class="form__section">
      <div class="section__item">
        <label for="encargado">Nombre del encargado</label>
        <input class="form__input" type="text" id="encargado" [(ngModel)]="encargado"/>
      </div>
      <div class="section__item">
        <label for="qualitySelect">Calidad del plátano:</label>
        <select class="form__input select" id="qualitySelect" [(ngModel)]="selectedQuality">
          <option value="first">Primera</option>
          <option value="second">Segunda</option>
        </select>
      </div>
      <div class="section__item">
        <label for="weightInput">Peso del plátano (kg):</label>
        <input class="form__input" type="number" id="weightInput" [(ngModel)]="newWeight"/>
      </div>
      <button class="button button--success" (click)="addWeight()" [disabled]="!newWeight">Agregar peso</button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Calidad</th>
            <th>Cantidad</th>
            <th>Peso (kg)</th>
            <th>Precio</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Primera</td>
            <td>{{ calculateTotalBunches(firstQualityWeights) }}</td>
            <td>{{ calculateTotalWeight(firstQualityWeights) }}</td>
            <td>{{ calculateTotalPrice(firstQualityWeights, firstQualityPricePerKilo) }}</td>
          </tr>
          <tr>
            <td>Segunda</td>
            <td>{{ calculateTotalBunches(secondQualityWeights) }}</td>
            <td>{{ calculateTotalWeight(secondQualityWeights) }}</td>
            <td>{{ calculateTotalPrice(secondQualityWeights, secondQualityPricePerKilo) }}</td>
          </tr>
          <tr>
            <td>Total</td>
            <td>{{ calculateTotalBunchesAll() }}</td>
            <td>{{ calculateTotalWeightAll() }}</td>
            <td>{{ calculateTotalPriceAll() }}</td>
          </tr>
        </tbody>        
      </table>
    </div>
    <button class="button button--success" (click)="finish()" [disabled]="(firstQualityWeights.length === 0 && secondQualityWeights.length === 0) || !encargado || viewConfirmationModal" *ngIf="!mostrarTodos">
      Finalizar Carga
    </button>
  </div>
  <div class="card" *ngIf="mostrarTodos">
    <h3>racimos de {{ qualityFilter ? "segunda" : "primera" }} calidad</h3>
    <div>
      <label for="pricePerKiloInput">Precio actual por kilo:</label>
      <input type="number" id="pricePerKiloInput" [(ngModel)]="qualityFilter ? secondQualityPricePerKilo : firstQualityPricePerKilo" disabled/>
    </div>
    <ul>
      <li
        *ngFor="let weight of qualityFilter ? firstQualityWeights : secondQualityWeights; let i = index">
        {{ weight }} kg
        <button (click)="deleteWeight(i)">Eliminar</button>
      </li>
    </ul>
  </div>

  <div class="confirmation-modal" *ngIf="viewConfirmationModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Facturación</h2>
      </div>
      <hr />
      <div class="modal-body">
        <div class="group">  
          <p class="item">total a pagar</p>
          <p class="item total">$   {{ calculateTotalPriceAll() }}</p>
        </div>
        <p class="item">nombre del encargado <span class="item--value">{{encargado}}</span></p>
        <div class="group">
          <p class="item">racimos de primera <span class="item--value">{{calculateTotalWeight(firstQualityWeights)}} /Kg</span></p>
          <p class="item">racimos de segunda <span class="item--value">{{calculateTotalWeight(secondQualityWeights)}} /Kg</span></p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="button button--cancel" (click)="onCancel()">Cancelar</button>
        <button class="button button--success" (click)="onConfirm()">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<app-notification *ngIf="showDialog" 
[message]="message" 
[positiveNotification]="positiveNotification" 
(closeNotification)="closeNotification()">
</app-notification>